---
import Base from "@/layouts/Base.astro";
import Product from "@/layouts/components/Product.astro";

import axios from "axios";
import * as cheerio from "cheerio";

export async function fetchResources() {
  const url = "https://www.teacherspayteachers.com/store/ciaras-classroom";
  const { data } = await axios.get(url);
  const $ = cheerio.load(data);

  const products = [];

  $(".ProductRowLayout").each((index, element) => {
    const title = $(element).find("h2").text().trim();
    const image = $(element).find("picture img").attr("src");
    const description = $(element)
      .find("[class*='ProductRowCard-module__cardDescription']")
      .text()
      .trim();
    const price = $(element)
      .find(
        "[class*='ProductPrice-module__price'] [class*='Text-module__root']",
      )
      .text()
      .trim();
    const link =
      "https://www.teacherspayteachers.com" +
      $(element).find("a").attr("href");
    products.push({ title, image, description, price, link });
  });

  return products;
}

const products = await fetchResources();
---

<Base>
  <section class="section">
    <div class="container mx-auto px-4 py-8">
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
        {
          products.map((resource) => (
            <a
              href={resource.link}
              key={resource.title}
              class="block bg-white border border-gray-200 rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300"
            >
              <img
                src={resource.image}
                alt={resource.title}
                class="w-full h-48 object-cover"
              />
              <div class="p-4">
                <h2 class="text-lg font-semibold mb-2">{resource.title}</h2>
                <p class="text-gray-600 mb-2 line-clamp-5">
                  {resource.description}
                </p>
                <p class="text-gray-800 font-bold mb-2">{resource.price}</p>
              </div>
            </a>
          ))
        }
      </div>
    </div>
  </section>
</Base>
